name: BuildJS
on: [push, pull_request]
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:

    - name: Install node
      uses: actions/setup-node@v1
      with:
          node-version: '10.x'

    - name: Check out code
      uses: actions/checkout@v1
    
    - name: Install
      run: npm ci

    - name: Build
      run: npm run build:local

    - name: Test
      run: npm run test

  e2e:
    name: e2e
    runs-on: ubuntu-latest
    steps:
  
    - name: Install node
      uses: actions/setup-node@v1
      with:
          node-version: '10.x'
  
    - name: Check out code
      uses: actions/checkout@v1
    
    - name: Install
      run: npm ci
  
    - name: Build
      run: npm run dev &
  
    - name: Start Server
      run: |
        config=`cat RuntimeConfig.json`
        docker pull jeffriggle/sona-server:master
        docker run -i -e CONFIG="$config" -p 8080:8080 jeffriggle/sona-server:master &
      working-directory: ./test

    - name: Test
      run: npm run test:e2e
